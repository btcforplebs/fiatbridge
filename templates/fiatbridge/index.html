{% extends "base.html" %}

{% from "macros.jinja" import window_vars with context %}

{% block page %}
<div class="row q-col-gutter-md">
    <div class="col-12 col-md-8 col-lg-7 q-gutter-y-md">
        <q-card>
            <q-card-section>
                <h3 class="q-my-none">Fiat Bridge</h3>
                <p>The Fiat Bridge links a website's shopping cart to the LNbits core system. It allows customers to pay
                    in Dollars, but delivers Bitcoin to the shop owner.</p>
            </q-card-section>

            <q-card-section>
                <div class="text-h6">How it works</div>
                <div class="q-mt-md text-body1">
                    <p><strong class="text-primary">Website (USD):</strong> When a customer checks out, the website
                        sends the Dollar amount (e.g., $20.00) to the bridge. It does not convert it to Bitcoin yet.</p>
                    <p><strong class="text-primary">Stripe:</strong> The bridge creates a standard credit card checkout
                        link for that Dollar amount.</p>
                    <p><strong class="text-primary">Settlement (Bitcoin):</strong> Once the customer pays the $20.00,
                        the system automatically converts the equivalent amount of Bitcoin and deposits it into the
                        shop's wallet.</p>
                </div>

                <div class="q-mt-lg">
                    <div class="text-h6 q-mb-sm">In short:</div>
                    <ul class="q-pl-md text-subtitle1">
                        <li>Customer sees: <span class="text-weight-bold">Dollars ($)</span></li>
                        <li>Customer pays: <span class="text-weight-bold">Dollars ($)</span></li>
                        <li>Shop receives: <span class="text-weight-bold">Bitcoin (⚡)</span></li>
                    </ul>
                </div>

                <div class="q-mt-xl text-center q-pa-lg rounded-borders shadow-2"
                    style="background: rgba(255, 255, 255, 0.05); border: 2px dashed #4caf50;">
                    <div class="text-h5 q-mb-md text-weight-bold text-primary">Simple Flow</div>
                    <div class="text-h6 text-weight-medium">
                        Checkout ($) ⟶ Stripe Payment ($) ⟶ Bridge Converts ⟶ Wallet Deposit (Bitcoin)
                    </div>
                </div>
            </q-card-section>

            <q-card-section>
                <div class="text-h6 q-mb-md">Why Fiat Bridge?</div>
                <p class="text-body1">Standard LNbits only allows this "Stripe-to-Bitcoin" flow via its Point of Sale
                    (TPOS extension) or manual admin panel. It is designed for a merchant to type an amount on a tablet
                    in person.</p>
                <p class="text-body1 text-weight-bold text-secondary">The Fiat Bridge was built to unlock this
                    capability for Online Web Checkouts.</p>

                <div class="row q-col-gutter-lg q-mt-md">
                    <div class="col-12 col-md-6">
                        <div class="q-pa-md rounded-borders"
                            style="background: rgba(244, 67, 54, 0.1); border: 1px solid #f44336; height: 100%;">
                            <div class="text-h6 text-red q-mb-sm">The Problem (Standard)</div>
                            <ul class="q-pl-md text-body2 q-gutter-y-xs">
                                <li><strong>POS Only:</strong> Locked behind a tablet interface.</li>
                                <li><strong>Manual:</strong> Requires a human to type amounts.</li>
                                <li><strong>No API:</strong> Websites cannot request Stripe sessions.</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-12 col-md-6">
                        <div class="q-pa-md rounded-borders"
                            style="background: rgba(76, 175, 80, 0.1); border: 1px solid #4caf50; height: 100%;">
                            <div class="text-h6 text-green q-mb-sm">The Solution (Bridge)</div>
                            <ul class="q-pl-md text-body2 q-gutter-y-xs">
                                <li><strong>Automated:</strong> The website acts as a Virtual POS.</li>
                                <li><strong>API Driven:</strong> Fully automated web checkouts.</li>
                                <li><strong>Seamless:</strong> Handles the Stripe-to-Sats flow.</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <p class="q-mt-lg text-body1 font-italic"><strong>Summary:</strong> We took the "In-Person POS"
                    capability and wrapped it in an API so the Website can use it too.</p>
            </q-card-section>

        </q-card>

        <q-card shadow-5>
            <q-card-section>
                <div class="text-h6 q-mb-md">How to integrate into your site</div>

                <div class="text-subtitle1 text-weight-bold">Step 1: Authentication</div>
                <p>All requests must include your <strong>Invoice Key</strong> in the headers. You can find this in the
                    LNbits wallet sidebar.</p>
                <code class="q-pa-sm bg-grey-3 text-black display-block q-mb-md"
                    style="display: block;">X-Api-Key: &lt;your_invoice_key&gt;</code>

                <div class="text-subtitle1 text-weight-bold q-mt-lg">Step 2: Create Checkout</div>
                <p>Send a POST request to the bridge endpoint with your order details:</p>
                <code class="q-pa-sm bg-grey-3 text-black display-block q-mb-sm"
                    style="display: block;">POST /fiatbridge/api/v1/checkout</code>

                <pre class="q-pa-md bg-grey-9 text-white rounded-borders">
{
  "amount": 20.00,
  "memo": "Bakery Order #123",
  "success_url": "https://yoursite.com/thank-you"
}
                </pre>

                <div class="text-subtitle1 text-weight-bold q-mt-lg">Step 3: Redirect Customer</div>
                <p>The bridge returns a JSON response. You must redirect your customer to the <code>checkout_url</code>
                    provided:</p>
                <pre class="q-pa-md bg-grey-9 text-white rounded-borders">
{
  "checkout_url": "https://checkout.stripe.com/c/pay/...",
  "payment_hash": "...",
  "total_amount": 20.00
}
                </pre>

                <div class="q-mt-lg bg-blue-1 q-pa-md rounded-borders text-blue-9 border-blue">
                    <q-icon name="info" size="sm" class="q-mr-sm" />
                    <strong>Note:</strong> Once the customer pays on Stripe, LNbits handles the Satoshi conversion and
                    deposits the funds into your wallet automatically. Your website can simply wait for the user to
                    return to the <code>success_url</code>.
                </div>
            </q-card-section>
        </q-card>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ window_vars(user) }}
<script src="{{ static_url_for('fiatbridge/static', path='js/index.js') }}"></script>
{% endblock %}